<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>星门输入法预览</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0b0c2a; color:#fff; font-family:"Microsoft YaHei"; text-align:center; margin:0; padding:20px; }
  h2 { margin-bottom:10px; }
  #keyboard { display:flex; flex-wrap:wrap; justify-content:center; margin-top:20px; }
  .key-btn {
    background:#f0c000; color:#000; border:none; border-radius:6px;
    padding:12px; margin:4px; font-size:18px; min-width:40px; cursor:pointer;
    box-shadow:0 0 6px #f0c00066; transition:transform 0.1s ease;
  }
  .key-btn:hover { transform:scale(1.05); }
  #inputBox { margin-top:20px; padding:10px; width:90%; font-size:16px; border-radius:8px; border:none; }
  #candidates { display:flex; flex-wrap:wrap; justify-content:center; margin-top:12px; min-height:60px; }
  .candidate {
    margin:4px; cursor:pointer; display:inline-block; width:40px; height:40px;
  }
  #backBtn { margin-top:20px; padding:8px 14px; background:#007bff; color:#fff; border:none; border-radius:6px; }
</style>
</head>
<body>
<h2>🌠 星门语言输入法预览</h2>
<p>输入拉丁字母组合匹配字符</p>
<input type="text" id="inputBox" placeholder="在这里输入拉丁字母..." />
<div id="candidates"></div>
<div id="keyboard"></div>
<button id="backBtn" onclick="window.location.href='auto-save-draw.html'">返回造字页面</button>

<script src="render.js"></script>
<script>
window.addEventListener("DOMContentLoaded", () => {
  const data = localStorage.getItem("stargate_chars");
  if (!data) { alert("未检测到字符数据，请先造字！"); return; }
  const parsed = JSON.parse(data);
  const keyboard = document.getElementById("keyboard");
  const inputBox = document.getElementById("inputBox");
  const candidatesDiv = document.getElementById("candidates");

  // 创建 A~Z 键盘
  for (let i = 65; i <= 90; i++) {
    const btn = document.createElement("button");
    btn.className = "key-btn";
    const letter = String.fromCharCode(i);
    btn.textContent = letter;
    btn.addEventListener("click", () => {
      inputBox.value += letter.toLowerCase();
      updateCandidates();
    });
    keyboard.appendChild(btn);
  }

  // 回退键
  const backBtn = document.createElement("button");
  backBtn.className = "key-btn";
  backBtn.textContent = "⌫";
  backBtn.addEventListener("click", () => {
    inputBox.value = inputBox.value.slice(0, -1);
    updateCandidates();
  });
  keyboard.appendChild(backBtn);

  function updateCandidates() {
    const input = inputBox.value.toLowerCase();
    candidatesDiv.innerHTML = "";
    if (!input) return;

    const matched = parsed.chars.filter(c => c.name.startsWith(input));
    matched.forEach(c => {
      const canvas = document.createElement("canvas");
      canvas.width = 40;
      canvas.height = 40;
      renderChar(c.strokes, 40, 40, canvas.getContext("2d"));
      canvas.className = "candidate";

      canvas.addEventListener("click", () => {
        // 点击候选字符插入输入框
        const img = document.createElement("img");
        img.src = canvas.toDataURL();
        img.style.width = "30px";
        img.style.height = "30px";
        img.style.verticalAlign = "middle";
        inputBox.value = ""; // 清空输入的拉丁字母组合
        inputBox.appendChild(img);
        candidatesDiv.innerHTML = "";
      });

      candidatesDiv.appendChild(canvas);
    });
  }

  // 监听键盘输入
  inputBox.addEventListener("input", updateCandidates);
});
</script>
</body>
</html>
