<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ˜Ÿé—¨è¾“å…¥æ³•é¢„è§ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0b0c2a; color:#fff; font-family:"Microsoft YaHei"; text-align:center; margin:0; padding:20px; }
  h2 { margin-bottom:10px; }
  #keyboard { display:flex; flex-wrap:wrap; justify-content:center; margin-top:20px; }
  .key-btn {
    background:#f0c000; color:#000; border:none; border-radius:6px;
    padding:12px; margin:4px; font-size:18px; min-width:40px; cursor:pointer;
    box-shadow:0 0 6px #f0c00066; transition:transform 0.1s ease;
  }
  .key-btn:hover { transform:scale(1.05); }
  #inputBox { margin-top:20px; padding:10px; width:90%; font-size:16px; border-radius:8px; border:none; }
  #candidates { display:flex; flex-wrap:wrap; justify-content:center; margin-top:12px; min-height:60px; }
  .candidate {
    margin:4px; cursor:pointer; display:inline-block; width:40px; height:40px;
  }
  #backBtn { margin-top:20px; padding:8px 14px; background:#007bff; color:#fff; border:none; border-radius:6px; }
</style>
</head>
<body>
<h2>ğŸŒ  æ˜Ÿé—¨è¯­è¨€è¾“å…¥æ³•é¢„è§ˆ</h2>
<p>è¾“å…¥æ‹‰ä¸å­—æ¯ç»„åˆåŒ¹é…å­—ç¬¦</p>
<input type="text" id="inputBox" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‹‰ä¸å­—æ¯..." />
<div id="candidates"></div>
<div id="keyboard"></div>
<button id="backBtn" onclick="window.location.href='auto-save-draw.html'">è¿”å›é€ å­—é¡µé¢</button>

<script src="render.js"></script>
<script>
window.addEventListener("DOMContentLoaded", () => {
  const data = localStorage.getItem("stargate_chars");
  if (!data) { alert("æœªæ£€æµ‹åˆ°å­—ç¬¦æ•°æ®ï¼Œè¯·å…ˆé€ å­—ï¼"); return; }
  const parsed = JSON.parse(data);
  const keyboard = document.getElementById("keyboard");
  const inputBox = document.getElementById("inputBox");
  const candidatesDiv = document.getElementById("candidates");

  // åˆ›å»º A~Z é”®ç›˜
  for (let i = 65; i <= 90; i++) {
    const btn = document.createElement("button");
    btn.className = "key-btn";
    const letter = String.fromCharCode(i);
    btn.textContent = letter;
    btn.addEventListener("click", () => {
      inputBox.value += letter.toLowerCase();
      updateCandidates();
    });
    keyboard.appendChild(btn);
  }

  // å›é€€é”®
  const backBtn = document.createElement("button");
  backBtn.className = "key-btn";
  backBtn.textContent = "âŒ«";
  backBtn.addEventListener("click", () => {
    inputBox.value = inputBox.value.slice(0, -1);
    updateCandidates();
  });
  keyboard.appendChild(backBtn);

  function updateCandidates() {
    const input = inputBox.value.toLowerCase();
    candidatesDiv.innerHTML = "";
    if (!input) return;

    const matched = parsed.chars.filter(c => c.name.startsWith(input));
    matched.forEach(c => {
      const canvas = document.createElement("canvas");
      canvas.width = 40;
      canvas.height = 40;
      renderChar(c.strokes, 40, 40, canvas.getContext("2d"));
      canvas.className = "candidate";

      canvas.addEventListener("click", () => {
        // ç‚¹å‡»å€™é€‰å­—ç¬¦æ’å…¥è¾“å…¥æ¡†
        const img = document.createElement("img");
        img.src = canvas.toDataURL();
        img.style.width = "30px";
        img.style.height = "30px";
        img.style.verticalAlign = "middle";
        inputBox.value = ""; // æ¸…ç©ºè¾“å…¥çš„æ‹‰ä¸å­—æ¯ç»„åˆ
        inputBox.appendChild(img);
        candidatesDiv.innerHTML = "";
      });

      candidatesDiv.appendChild(canvas);
    });
  }

  // ç›‘å¬é”®ç›˜è¾“å…¥
  inputBox.addEventListener("input", updateCandidates);
});
</script>
</body>
</html>
