<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ˜Ÿé—¨å­—ç¬¦é€ å­—ç³»ç»Ÿ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { margin:0; padding:20px; background:#0b0c2a; color:#fff; font-family:"Microsoft YaHei"; text-align:center; }
  canvas { background:#111; border:1px solid #f0c000; border-radius:6px; margin-top:10px; }
  button { margin:6px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-size:15px; }
  #saveBtn { background:#f0c000; color:#000; }
  #clearBtn { background:#444; color:#fff; }
  #exportBtn { background:#007bff; color:#fff; }
  .char-item { border:1px solid #f0c000; margin:10px; padding:10px; border-radius:6px; }
</style>
</head>
<body>

<h2>ğŸŒŒ æ˜Ÿé—¨å­—ç¬¦é€ å­—ç³»ç»Ÿ</h2>
<canvas id="canvas" width="300" height="300"></canvas><br>
<button id="clearBtn" onclick="clearCanvas()">æ¸…ç©ºç”»å¸ƒ</button>
<button id="saveBtn" onclick="saveChar()">ä¿å­˜å­—ç¬¦</button>
<button id="exportBtn" onclick="exportChars()">å¯¼å‡º JSON</button>

<h3>å·²ä¿å­˜å­—ç¬¦</h3>
<div id="chars"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false, strokes = [], currentCharStrokes = [];
let allChars = JSON.parse(localStorage.getItem("stargate_chars")) || { chars: [] };

// è·å–è§¦æ‘¸æˆ–é¼ æ ‡ä½ç½®
function getPos(e){
    const rect = canvas.getBoundingClientRect();
    return e.touches ? 
        {x:e.touches[0].clientX-rect.left, y:e.touches[0].clientY-rect.top} :
        {x:e.clientX-rect.left, y:e.clientY-rect.top};
}

// ç»˜åˆ¶æ‰€æœ‰ç¬”ç”»ï¼Œå¹³æ»‘å¤„ç†
function drawCurrent(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle="#f0c000"; ctx.lineWidth=3; ctx.lineJoin="round"; ctx.lineCap="round";
    for(const stroke of [...currentCharStrokes, strokes]){
        if(stroke.length<1) continue;
        ctx.beginPath();
        ctx.moveTo(stroke[0].x, stroke[0].y);
        for(let i=1;i<stroke.length;i++){
            const prev=stroke[i-1], curr=stroke[i];
            const midX=(prev.x+curr.x)/2, midY=(prev.y+curr.y)/2;
            ctx.quadraticCurveTo(prev.x, prev.y, midX, midY);
        }
        ctx.stroke();
    }
}

// äº‹ä»¶ç»‘å®š
canvas.addEventListener('mousedown',e=>{drawing=true; strokes=[getPos(e)]; drawCurrent();});
canvas.addEventListener('mousemove',e=>{if(!drawing) return; strokes.push(getPos(e)); drawCurrent();});
canvas.addEventListener('mouseup',()=>{drawing=false; if(strokes.length>0){currentCharStrokes.push(strokes); strokes=[];} drawCurrent();});

canvas.addEventListener('touchstart',e=>{e.preventDefault(); drawing=true; strokes=[getPos(e)]; drawCurrent();});
canvas.addEventListener('touchmove',e=>{e.preventDefault(); if(!drawing) return; strokes.push(getPos(e)); drawCurrent();});
canvas.addEventListener('touchend',()=>{drawing=false; if(strokes.length>0){currentCharStrokes.push(strokes); strokes=[];} drawCurrent();});

// æ¸…ç©ºç”»å¸ƒ
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); strokes=[]; currentCharStrokes=[]; }

// ä¿å­˜å­—ç¬¦
function saveChar(){
    if(currentCharStrokes.length===0) return alert("è¯·å…ˆç»˜åˆ¶ä¸€ä¸ªå­—ç¬¦ï¼");
    const name = prompt("è¯·è¾“å…¥å­—ç¬¦åç§°", "char_"+Date.now());
    if(!name) return;
    allChars.chars.push({name, strokes:currentCharStrokes});
    localStorage.setItem("stargate_chars", JSON.stringify(allChars));
    updateList();
    currentCharStrokes=[];
    clearCanvas();
}

// æ›´æ–°åˆ—è¡¨
function updateList(){
    const list = document.getElementById("chars");
    list.innerHTML="";
    allChars.chars.forEach(c=>{
        const div=document.createElement("div");
        div.className="char-item";
        div.textContent="âœ¨ "+c.name;
        list.appendChild(div);
    });
}

// å¯¼å‡º JSONï¼Œç”¨äº Android assets
function exportChars(){
    const jsonStr = JSON.stringify(allChars,null,2);
    const blob = new Blob([jsonStr],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url; a.download="stargate_chars.json"; a.click();
    URL.revokeObjectURL(url);
    alert("å·²å¯¼å‡º stargate_chars.jsonï¼Œå¯ä»¥æ”¾åˆ° Android assets ä½¿ç”¨ï¼");
}

updateList();
</script>
</body>
</html>
