<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>星门字符绘制</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0b0c2a; color:#fff; font-family:"Microsoft YaHei"; text-align:center; margin:0; padding:20px; }
  canvas { background:#111; border:1px solid #f0c000; border-radius:6px; margin-top:10px; touch-action: none; }
  button { margin:8px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-size:15px; }
  #saveBtn { background:#f0c000; color:#000; }
</style>
</head>
<body>
<h2>🌌 星门字符绘制</h2>
<input type="text" id="charName" placeholder="字符名称（拉丁音名）">
<canvas id="drawCanvas" width="300" height="300"></canvas>
<br>
<button id="saveBtn">保存字符</button>
<button onclick="window.location.href='index.html'">返回输入法预览</button>

<script src="render.js"></script>
<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
let strokes = [];
let currentStroke = [];
let drawing = false;

function startStroke(e) {
  drawing = true;
  currentStroke = [];
  addPoint(e);
}
function endStroke() { if (!drawing) return; drawing = false; strokes.push(currentStroke); }
function addPoint(e) {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX ? e.clientX - rect.left : e.touches[0].clientX - rect.left;
  const y = e.clientY ? e.clientY - rect.top : e.touches[0].clientY - rect.top;
  currentStroke.push({x, y});
  redraw();
}
function redraw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  renderChar(strokes, canvas.width, canvas.height, canvas);
}

canvas.addEventListener('mousedown', startStroke);
canvas.addEventListener('mouseup', endStroke);
canvas.addEventListener('mousemove', e => drawing && addPoint(e));
canvas.addEventListener('touchstart', startStroke);
canvas.addEventListener('touchend', endStroke);
canvas.addEventListener('touchmove', e => { if(drawing){ addPoint(e); e.preventDefault(); } });

// 保存字符到 localStorage
document.getElementById('saveBtn').addEventListener('click', () => {
  const name = document.getElementById('charName').value.trim();
  if (!name) return alert('请输入字符名称！');
  const data = JSON.parse(localStorage.getItem('stargate_chars')) || { chars: [] };
  const existingIndex = data.chars.findIndex(c => c.name === name);
  if (existingIndex >= 0) data.chars[existingIndex] = { name, strokes };
  else data.chars.push({ name, strokes });
  localStorage.setItem('stargate_chars', JSON.stringify(data));
  alert('✅ 字符已保存到系统！');
  strokes = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.getElementById('charName').value = '';
});
</script>
</body>
</html>
